<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Data Streaming, Confluent, Kafka, MSDS, University of San Francisco, usfca"><meta name=author content="Jeremy Wenxiao Gu"><link href=https://pandaisfast.github.io/msds682-fall2023-data-streaming/lec3/ rel=canonical><link href=../lec2/demo_2b/ rel=prev><link href=3.1/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.4.2"><title>Lecture 3. Apache Kafka Part 2. Consumers - MSDS 682 Data Stream Processing</title><link rel=stylesheet href=../assets/stylesheets/main.d451bc0e.min.css><link rel=stylesheet href=../assets/stylesheets/palette.a5377069.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/timeago.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script> <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=deep-orange> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#lecture-3-apache-kafka-part-2-consumers class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="MSDS 682 Data Stream Processing" class="md-header__button md-logo" aria-label="MSDS 682 Data Stream Processing" data-md-component=logo> <img src=../assets/usf_f_c_2c_rgb.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> MSDS 682 Data Stream Processing </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Lecture 3. Apache Kafka Part 2. Consumers </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=deep-orange aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_5 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=deep-orange aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_3> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_4> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_3 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_5> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_4 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/pandaisfast/msds682-fall2023-data-streaming title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> pandaisfast/msds682-fall2023-data-streaming </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="MSDS 682 Data Stream Processing" class="md-nav__button md-logo" aria-label="MSDS 682 Data Stream Processing" data-md-component=logo> <img src=../assets/usf_f_c_2c_rgb.png alt=logo> </a> MSDS 682 Data Stream Processing </label> <div class=md-nav__source> <a href=https://github.com/pandaisfast/msds682-fall2023-data-streaming title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> pandaisfast/msds682-fall2023-data-streaming </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <div class="md-nav__link md-nav__container"> <a href=.. class="md-nav__link "> <span class=md-ellipsis> Overview </span> </a> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Overview </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <div class="md-nav__link md-nav__container"> <a href=../lec1/ class="md-nav__link "> <span class=md-ellipsis> Lec 1: 10/20 F (Room 529) </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Lec 1: 10/20 F (Room 529) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec1/1.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> <li class=md-nav__item> <a href=../lec1/demo_or_exercise/ class=md-nav__link> <span class=md-ellipsis> Demo 1 </span> </a> </li> <li class=md-nav__item> <a href=../lec1/assignment/ class=md-nav__link> <span class=md-ellipsis> Assignment 1 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../lec2/ class="md-nav__link "> <span class=md-ellipsis> Lec 2: 10/24 T (Room 529) </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Lec 2: 10/24 T (Room 529) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec2/2.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> <li class=md-nav__item> <a href=../assets/msds-lec2-topic-producer/demo_a_creating_topic/ class=md-nav__link> <span class=md-ellipsis> Notebook - Setup &amp; Creating Topics </span> </a> </li> <li class=md-nav__item> <a href=../assets/msds-lec2-topic-producer/demo_b_producer_async/ class=md-nav__link> <span class=md-ellipsis> Notebook - Asynchronous Producer </span> </a> </li> <li class=md-nav__item> <a href=../assets/msds-lec2-topic-producer/demo_c_producer_compare/ class=md-nav__link> <span class=md-ellipsis> Notebook - Compare Async and Sync Producers </span> </a> </li> <li class=md-nav__item> <a href=../assets/msds-lec2-topic-producer/demo_b_producer_serialization/ class=md-nav__link> <span class=md-ellipsis> Notebook - Asynchronous Producer w/ Serialization </span> </a> </li> <li class=md-nav__item> <a href=../lec2/demo_2a/ class=md-nav__link> <span class=md-ellipsis> Demo 2A </span> </a> </li> <li class=md-nav__item> <a href=../lec2/demo_2b/ class=md-nav__link> <span class=md-ellipsis> Demo 2B </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <div class="md-nav__link md-nav__container"> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Lec 3: 10/27 F (Room 529) </span> </a> <label class="md-nav__link md-nav__link--active" for=__nav_4 id=__nav_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Lec 3: 10/27 F (Room 529) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=3.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> <li class=md-nav__item> <a href=../assets/msds-lec3-consumer/demo_d_consumer_v2/ class=md-nav__link> <span class=md-ellipsis> Notebook - Consumer </span> </a> </li> <li class=md-nav__item> <a href=demo_or_exercise/ class=md-nav__link> <span class=md-ellipsis> Demo 3A </span> </a> </li> <li class=md-nav__item> <a href=demo_or_exercise_2/ class=md-nav__link> <span class=md-ellipsis> Demo 3B </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <div class="md-nav__link md-nav__container"> <a href=../lec4/ class="md-nav__link "> <span class=md-ellipsis> Lec 4: 10/31 T (Room 529) </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Lec 4: 10/31 T (Room 529) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec4/4.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <div class="md-nav__link md-nav__container"> <a href=../lec5/ class="md-nav__link "> <span class=md-ellipsis> Lec 5: 11/03 F (Room 529) </span> </a> <label class="md-nav__link " for=__nav_6 id=__nav_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Lec 5: 11/03 F (Room 529) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec5/5.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <div class="md-nav__link md-nav__container"> <a href=../lec6/ class="md-nav__link "> <span class=md-ellipsis> Lec 6: 11/07 T (Room 529) </span> </a> <label class="md-nav__link " for=__nav_7 id=__nav_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Lec 6: 11/07 T (Room 529) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec6/6.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <div class="md-nav__link md-nav__container"> <a href=../lec7/ class="md-nav__link "> <span class=md-ellipsis> Lec 7: 11/10 F (Room 529) </span> </a> <label class="md-nav__link " for=__nav_8 id=__nav_8_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Lec 7: 11/10 F (Room 529) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec7/7.1.md class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> <li class=md-nav__item> <a href=../lec7/assignment3/ class=md-nav__link> <span class=md-ellipsis> Assignment 3 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <div class="md-nav__link md-nav__container"> <a href=../lec8/ class="md-nav__link "> <span class=md-ellipsis> Lec 8: 11/14 T (Room 529) </span> </a> <label class="md-nav__link " for=__nav_9 id=__nav_9_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Lec 8: 11/14 T (Room 529) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec8/8.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10> <div class="md-nav__link md-nav__container"> <a href=../lec9/ class="md-nav__link "> <span class=md-ellipsis> Lec 9: 11/17 F (Room 527) </span> </a> <label class="md-nav__link " for=__nav_10 id=__nav_10_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Lec 9: 11/17 F (Room 527) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec9/9.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11> <div class="md-nav__link md-nav__container"> <a href=../lec10/ class="md-nav__link "> <span class=md-ellipsis> Lec 10: 11/21 T (Room 529) </span> </a> <label class="md-nav__link " for=__nav_11 id=__nav_11_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Lec 10: 11/21 T (Room 529) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec10/10.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_12> <div class="md-nav__link md-nav__container"> <a href=../lec11/ class="md-nav__link "> <span class=md-ellipsis> Lec 11: 11/24 F (Room 529) </span> </a> <label class="md-nav__link " for=__nav_12 id=__nav_12_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_12_label aria-expanded=false> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> Lec 11: 11/24 F (Room 529) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec11/11.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_13> <div class="md-nav__link md-nav__container"> <a href=../lec12/ class="md-nav__link "> <span class=md-ellipsis> Lec 12: 11/28 T (Room 529) </span> </a> <label class="md-nav__link " for=__nav_13 id=__nav_13_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_13_label aria-expanded=false> <label class=md-nav__title for=__nav_13> <span class="md-nav__icon md-icon"></span> Lec 12: 11/28 T (Room 529) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec12/12.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_14> <div class="md-nav__link md-nav__container"> <a href=../lec13/ class="md-nav__link "> <span class=md-ellipsis> Lec 13: 12/01 F (Room 529) </span> </a> <label class="md-nav__link " for=__nav_14 id=__nav_14_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_14_label aria-expanded=false> <label class=md-nav__title for=__nav_14> <span class="md-nav__icon md-icon"></span> Lec 13: 12/01 F (Room 529) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec13/13.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_15> <div class="md-nav__link md-nav__container"> <a href=../lec14/ class="md-nav__link "> <span class=md-ellipsis> Lec 14: 12/05 T (Room 157) </span> </a> <label class="md-nav__link " for=__nav_15 id=__nav_15_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_15_label aria-expanded=false> <label class=md-nav__title for=__nav_15> <span class="md-nav__icon md-icon"></span> Lec 14: 12/05 T (Room 157) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lec14/14.1/ class=md-nav__link> <span class=md-ellipsis> Additional Topics </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_16> <label class=md-nav__link for=__nav_16 id=__nav_16_label tabindex=0> <span class=md-ellipsis> Course Project </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_16_label aria-expanded=false> <label class=md-nav__title for=__nav_16> <span class="md-nav__icon md-icon"></span> Course Project </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../course_project/project_intro.md class=md-nav__link> <span class=md-ellipsis> Project Introduction </span> </a> </li> <li class=md-nav__item> <a href=../course_project/project_guidelines.md class=md-nav__link> <span class=md-ellipsis> Project Guidelines </span> </a> </li> <li class=md-nav__item> <a href=../course_project/project_examples.md class=md-nav__link> <span class=md-ellipsis> Project Examples </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_17> <div class="md-nav__link md-nav__container"> <a href=../appendix1/ class="md-nav__link "> <span class=md-ellipsis> Appendix 1: Frequently Asked Questions </span> </a> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_17_label aria-expanded=false> <label class=md-nav__title for=__nav_17> <span class="md-nav__icon md-icon"></span> Appendix 1: Frequently Asked Questions </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_18> <div class="md-nav__link md-nav__container"> <a href=../appendix2/ class="md-nav__link "> <span class=md-ellipsis> Appendix 2: Recommended Courses, Books, Videos, Blogs </span> </a> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_18_label aria-expanded=false> <label class=md-nav__title for=__nav_18> <span class="md-nav__icon md-icon"></span> Appendix 2: Recommended Courses, Books, Videos, Blogs </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#kafka-consumers-overview class=md-nav__link> Kafka Consumers Overview </a> <nav class=md-nav aria-label="Kafka Consumers Overview"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_1 class=md-nav__link> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#consumer-implementation class=md-nav__link> Consumer Implementation </a> <nav class=md-nav aria-label="Consumer Implementation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#committing-offsets class=md-nav__link> Committing offsets </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#kafka-consumer-group class=md-nav__link> Kafka Consumer Group </a> </li> <li class=md-nav__item> <a href=#subscription class=md-nav__link> Subscription </a> </li> <li class=md-nav__item> <a href=#absolutely-lets-structure-the-information-and-expand-on-it-to-provide-more-clarity class=md-nav__link> Absolutely! Let's structure the information and expand on it to provide more clarity: </a> <nav class=md-nav aria-label="Absolutely! Let's structure the information and expand on it to provide more clarity:"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#poll-method class=md-nav__link> Poll Method </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=lecture-3-apache-kafka-part-2-consumers>Lecture 3. Apache Kafka Part 2. Consumers</h1> <h2 id=kafka-consumers-overview>Kafka Consumers Overview</h2> <p>Consumers read<sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup> events from topics but don't remove them; topics remain immutable and durable.</p> <p>Consumers subscribe<sup id=fnref:2><a class=footnote-ref href=#fn:2>2</a></sup> to topics and read events from oldest to newest.</p> <hr> <h3 id=_1></h3> <p>In Apache Kafka, each topic can be split into multiple partitions. Within each partition, messages (or events) are assigned a unique, sequential identifier called an "offset". </p> <p>When a consumer reads messages from a partition, it reads them in the order of their offsets, starting from the smallest (oldest) to the largest (most recent). This ensures that the consumer processes the messages in the same order they were produced and added to the partition. </p> <p>For instance, if a partition has messages with offsets 1, 2, 3, and so on, the consumer will first read the message with offset 1, then the message with offset 2, and continue in this sequential manner.</p> <h2 id=consumer-implementation>Consumer Implementation</h2> <h3 id=committing-offsets>Committing offsets</h3> <p>Committing offsets allows Kafka to track a consumer's position so it can resume from the last committed offset in case of failures. Let's dive into the concept of committing offsets in Kafka and the distinction between synchronous and asynchronous commits.</p> <p><strong>Committing Offsets:</strong> When a consumer reads messages from a Kafka topic, it maintains a pointer, called an offset, to indicate up to which message it has read. "Committing" this offset means persistently storing this pointer so that, in case the consumer restarts, it can pick up right where it left off.</p> <p>In Kafka, the default behavior for committing offsets is automatic and asynchronous. This means:</p> <ol> <li> <p><strong>Automatic</strong>: Kafka's consumer will periodically commit the offset of messages that have been successfully returned by the <code>poll()</code> method, without the need for the application to explicitly ask for a commit. The frequency of this automatic commit is governed by the <code>auto.commit.interval.ms</code> setting.</p> </li> <li> <p><strong>Asynchronous</strong>: The commits are sent to the broker in the background, without blocking the consumer's processing. Asynchronous commits are generally faster because they don't wait for a response from the broker.</p> </li> </ol> <p>However, while this approach offers good performance, it may lead to at-least-once processing semantics. In the event of failures, some messages might be reprocessed since the commit might not have reached the broker before the failure occurred. For use cases that require exactly-once semantics, synchronous commits or manual offset management might be more appropriate.</p> <p><strong>Synchronous vs. Asynchronous Commit:</strong></p> <ol> <li> <p><strong>Synchronous Commit:</strong> The consumer sends a commit request and waits for the broker's acknowledgment. Only after receiving this acknowledgment does the consumer proceed to read more messages. This approach is safer but can be slower.</p> </li> <li> <p><strong>Asynchronous Commit:</strong> The consumer sends a commit request and immediately proceeds to read more messages without waiting for an acknowledgment from the broker. This approach is faster but carries a risk of data being re-read if the commit fails.</p> </li> </ol> <p><strong>Diagram for Asynchronous Commit:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>Consumer                  Kafka Broker
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>  |                           |
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>  | --- Read Msg (Offset 5)--&gt;|
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>  | &lt;---------Msg Received ---|
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>  |                           |
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>  | --- Async Commit 5 -------&gt;|
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>  |                           |
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>  | --- Read Msg (Offset 6)--&gt;|  (Before acknowledgment for Offset 5 commit is received)
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>  | &lt;---------Msg Received ---|
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>  |                           |
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>  | &lt;------ Ack Commit 5 ------|  (Ack received after the next message is read)
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>  |                           |
</span></code></pre></div> <p>In the above diagram, after reading the message with offset 5, the consumer immediately sends an asynchronous commit for that offset and proceeds to read the next message without waiting for an acknowledgment. The acknowledgment for the Offset 5 commit comes back to the consumer after it has already started reading the next message (with Offset 6). This demonstrates the asynchronous nature of the commit process.</p> <p>With asynchronous commits, there's a chance that even though the consumer has read and processed a message, if the commit fails and the consumer restarts, it might read the same message again.</p> <p><strong>Diagram for Synchronous Commit:</strong></p> <p>Here's the contrasted diagram showing the synchronous commit process:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>Consumer                  Kafka Broker
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>  |                           |
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>  | --- Read Msg (Offset 5)--&gt;|
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>  | &lt;---------Msg Received ---|
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>  |                           |
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>  | --- Sync Commit 5 -------&gt;|
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>  |                           |
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>  | &lt;------ Ack Commit 5 -----|  (Consumer waits for this acknowledgment)
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>  |                           |
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>  | --- Read Msg (Offset 6)--&gt;|  (Reading next message only after acknowledgment is received)
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>  | &lt;---------Msg Received ---|
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>  |                           |
</span></code></pre></div> <p>In the synchronous commit diagram, you can observe that the consumer reads the message with Offset 5 and commits it. It then waits for the acknowledgment of the commit before proceeding to read the next message (Offset 6). This waiting period ensures that the commit was successful, but can lead to slower message consumption compared to asynchronous commits.</p> <h3 id=_2></h3> <p>Here's a table that compares the terms "poll", "pull", "fetch", and some related concepts in the Kafka consumer context:</p> <table> <thead> <tr> <th>Term</th> <th>Description</th> <th>Kafka Relevance</th> </tr> </thead> <tbody> <tr> <td>Poll</td> <td>The action by which a Kafka consumer retrieves records from a Kafka topic.</td> <td>In many Kafka client libraries, the method to get records from Kafka is called <code>poll()</code>. When invoked, it fetches records that haven't been read yet by the consumer.</td> </tr> <tr> <td>Pull</td> <td>A mechanism where a consumer actively requests data from a provider, rather than having it pushed to them.</td> <td>Kafka's consumption model is pull-based. This means consumers actively request (or "pull") data from brokers, rather than brokers pushing data to consumers.</td> </tr> <tr> <td>Fetch</td> <td>The retrieval of data.</td> <td>In the Kafka context, "fetch" often refers to the actual retrieval of records from a broker in response to a <code>poll()</code> request. It's the mechanism behind the poll action.</td> </tr> <tr> <td>Consume</td> <td>The processing of fetched records.</td> <td>Once records are fetched by a Kafka consumer, they are "consumed", i.e., processed in some manner, such as storing, computing, or forwarding them.</td> </tr> <tr> <td>Offset</td> <td>A sequential ID assigned to records as they arrive in a Kafka partition.</td> <td>Offsets let consumers track their position within a topic. It's crucial for ensuring records are processed reliably.</td> </tr> <tr> <td>Commit</td> <td>Saving the last read offset, so that a consumer can pick up where it left off in case of restarts.</td> <td>Consumers can either automatically (default) or manually commit offsets. This tells Kafka up to which point records have been successfully consumed.</td> </tr> </tbody> </table> <p>This table provides a high-level comparison. Remember that while these terms have specific meanings within the Kafka context, they might be used differently in other systems or scenarios.</p> <p>I also create workflow chart to explain the relationship between these terms in the Kafka consumer context.</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>    +--------+
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>    | Broker |
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>    +--------+
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>        |
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>        | 1. Pull (Initiated by Consumer)
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>        v
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>+-------------------+
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>| Consumer Requests |
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>| Records using     |
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>| the &quot;poll()&quot;      |
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>| method            |
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>+-------------------+
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>        |
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>        | 2. Fetch (Broker sends data in response to poll)
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>        v
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>+-------------------+
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>| Records are       |
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>| Fetched by the    |
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>| Consumer          |
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>+-------------------+
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>        |
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>        | 3. Consume (Consumer processes fetched records)
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>        v
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>+-------------------+
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>| Consumer Processes|
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>| and Uses Records  |
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>| (e.g. store, log) |
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>+-------------------+
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>        |
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>        | 4. Commit (Saving the last read offset)
</span><span id=__span-2-31><a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>        v
</span><span id=__span-2-32><a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a>+-------------------+
</span><span id=__span-2-33><a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a>| Offset is Committed|
</span><span id=__span-2-34><a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a>| to Kafka to mark   |
</span><span id=__span-2-35><a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a>| progress           |
</span><span id=__span-2-36><a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a>+-------------------+
</span></code></pre></div> <p>The process flows from top to bottom, depicting the typical flow of records from the Kafka broker to the consumer.</p> <h2 id=kafka-consumer-group>Kafka Consumer Group</h2> <ol> <li><strong>Groups and Consumers</strong>: Every Kafka reader (or "consumer") is part of a group.</li> <li><strong>Unique ID</strong>: Each group has a unique identifier called "group.id".</li> <li><strong>Consumer Group</strong>: A logical set of consumers that consume from the same topic.</li> <li><strong>Same Logic, Different Partitions</strong>: Each consumer within a group runs the same logic but consumes data from different partitions.</li> <li><strong>Exclusive Partition Consumption</strong>: Within a group, data from a single partition is consumed by only one consumer.</li> <li><strong>Multiple Group Consumption</strong>: Different consumer groups can independently consume the same topic without interfering with each other.</li> <li><strong>Excess Consumers</strong>: If the number of consumers in a group exceeds the number of partitions in a topic, the extra consumers remain idle as they have no data to consume.</li> </ol> <p>Within the same consumer group (i.e., with the same <code>group.id</code>), it's generally recommended that all consumers have consistent settings. This ensures that all consumers in that group behave in a consistent manner, especially when it comes to handling offsets, rebalancing, and processing records. However, there might be some configurations that can differ, but fundamental configurations, especially those affecting processing semantics, should be consistent.</p> <h2 id=subscription>Subscription</h2> <ol> <li> <p><strong>Why use subscription in Kafka</strong>:</p> <ul> <li> <p><strong>Topic Specification</strong>: Consumers use subscriptions to specify which topics they want to consume from.</p> </li> <li> <p><strong>Load Balancing</strong>: For consumers in the same consumer group, Kafka automatically balances the load, ensuring each consumer reads from certain partitions, allowing parallel processing.</p> </li> <li> <p><strong>Dynamic Topic Matching</strong>: Consumers can subscribe to topics that match a certain pattern rather than specifying exact topics.</p> </li> </ul> </li> <li> <p><strong>Can we skip using subscription?</strong>:</p> <ul> <li> <p>Without using subscription, a consumer wouldn't know from which topic to fetch data. However, Kafka allows "manual assignment" where consumers can be directly assigned to specific partitions without subscribing to the whole topic. This bypasses Kafka's automatic load-balancing, making developers manually manage it.</p> </li> <li> <p>Manual assignment is useful in specific cases where precise control is needed, but generally, using subscriptions is more convenient as it automates partition assignment and balancing.</p> </li> </ul> </li> <li> <p><strong>Subscribing to Multiple Topics</strong>: </p> <ul> <li>A consumer can listen to more than one topic using a pattern. When using patterns, follow the "regexp" format.</li> </ul> </li> </ol> <h2 id=absolutely-lets-structure-the-information-and-expand-on-it-to-provide-more-clarity>Absolutely! Let's structure the information and expand on it to provide more clarity:</h2> <hr> <h3 id=poll-method>Poll Method</h3> <p><strong>1. The Poll Loop:</strong> - The core of most Kafka Consumers is the "poll" loop. This loop runs indefinitely, continuously retrieving and processing data from Kafka.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>    <span class=n>message</span> <span class=o>=</span> <span class=n>consumer</span><span class=o>.</span><span class=n>poll</span><span class=p>(</span><span class=n>timeout</span><span class=p>)</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=c1># process the message</span>
</span></code></pre></div> <p><strong>2. Poll vs. Consume:</strong> - Kafka Consumers provide two primary methods to retrieve data: <code>poll()</code> and <code>consume()</code>. - While both methods can be used to fetch messages, <code>poll()</code> is slightly more feature-rich and offers more granular control over fetching data. Thus, it's often preferred in many applications.</p> <p><strong>3. Properly Closing the Consumer:</strong> - Always ensure to call the <code>close()</code> method on your consumer before your application exits. <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>consumer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></code></pre></div> - If you don't, the Kafka broker will need extra time to detect that the consumer has disconnected, which can lead to delayed message processing and potential message failures. - Before closing the consumer, consume any remaining messages in the queue to ensure that no data is lost.</p> <p><strong>4. Why is Closing Important?</strong> - Failing to call <code>close()</code> means the Kafka Broker has to recognize that the consumer has left the consumer group on its own. - This detection takes time and could lead to failed message deliveries or message re-processing. - To maintain the reliability and efficiency of your Kafka-based applications, always close the consumer properly.</p> <div class=footnote> <hr> <ol> <li id=fn:1> <p>Read: Refers to the action where a consumer retrieves or accesses events from a Kafka topic. These events remain in the topic even after being read, ensuring their availability for potential re-reads or access by other consumer applications.&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> <li id=fn:2> <p>Subscribe: Refers to the act of a consumer indicating interest in one or more Kafka topics. Once subscribed, the consumer is eligible to receive events from those topics whenever they are produced. This sets the stage for the consumer to later read the events from the topics it has subscribed to.&#160;<a class=footnote-backref href=#fnref:2 title="Jump back to footnote 2 in the text">&#8617;</a></p> </li> </ol> </div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2023-10-30T21:28:59-07:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-10-30</span> <br> Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2023-09-18T07:55:48-07:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-09-18</span> </small> </div> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 Jeremy Wenxiao Gu </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.tracking", "navigation.indexes", "navigation.top", "navigation.path", "content.tooltips", "content.code.copy"], "search": "../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.726fbb30.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>